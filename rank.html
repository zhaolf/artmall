<!DOCTYPE html>
<html lang="zh-cn">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/common.css" rel="stylesheet" />
		<link href="css/mui.previewimage.css" rel="stylesheet" />
		<link href="css/biqiang.css" rel="stylesheet" />
		<script src="js/mui.min.js"></script>
		<style type="text/css">
		.artist-rank{
	  	/*background-color: #f6f6f6;*/
	  	/*margin-bottom: 4px;*/
	  	position: relative;
	  }
	  /*.artist-rank div{
	  	display: inline-block;
	  	width: 49%;
	  	vertical-align: top;
	  }*/
	  .rank-cover{
	  	/*height: 100px;
	  	width: 160px;*/
	  	position: relative;
	  	overflow: hidden;
	  	margin: 0 2px
	  }
	  .rank-cover img{
	    width: 100%;
	    border: 0;
	    /*top: -50%;*/
	    position: relative;
	  }
	  .rank-no{
	  	position: absolute;
	  	left: 0;
	  	top: 10px;
	  	height: 15px;
	  	line-height: 15px;
	  	width: 50px!important;
	  	color: #fff;
	  	background: url('img/ic_top.png') no-repeat;
	  	background-size: 100% 100%;
	  }
	  .rank-no span{
	  	transform: scale(0.5,0.5);
			-ms-transform: scale(0.5,0.5); 	/* IE 9 */
			-moz-transform: scale(0.5,0.5); 	/* Firefox */
			-webkit-transform: scale(0.5,0.5); /* Safari 和 Chrome */
			-o-transform: scale(0.5,0.5); 	/* Opera */
	  	font-size: 20px;
	    width: 100px;
	    position: absolute;
	    left: -20px;
	  }
	  .rank-info{
	  	/*padding-left: 15px;*/
	  	/*position: relative;*/
	  }
	  .rank-info h4{
	  	font-size: 14px;
	  	line-height: 1em;
	  	color: #000;
	  	text-align: center;
	  	margin: 13px 0 0;
	  }
	  .rank-info span{
	  	color: #949494;
	  	font-size: 12px;
	  	line-height: 1em;
	  }
	  .rank-info p{
	  	color: #949494;
	  	font-size: 13px;
	  	line-height: 1em;
	  	position: absolute;
	  	margin-bottom: 0;
	  }
	  .p-null{
	  	font-size: 16px;
	  	color: #c0c0c0;
	    margin-top: 10px;
	    text-align: center;
	    clear: both;
	  }
	  .btn-more{
	  	width: 300px;
	    background: #F8F8F8;
	    color: #B8B8B8;
	    margin: 10px auto;
	    height: 42px;
	    line-height: 42px;
	    text-align: center;
	    cursor: pointer;
	    border: none;
	    display: block;
	    padding: 0;
	  }
	  .bar-search{
	  	padding: 10px 15px 0;
	  }
	  #search{
	    text-align: left;
	    border: 1px solid #f2f2f2;
	  	font-size: 12px;
	  	padding: 0 10px;
	  	margin: 0;
	  	line-height: 26px;
	  	height: 26px;
	  	background: url('img/ic_search.png') no-repeat #fff;
	  	background-position: 98% center ;
	  	background-size: 15px 15px;
	  }
	  .nav-top{
	    border-bottom: 1px solid #d4d4d4!important;
	  	background: #fff;
	  	z-index: 9;
	  	height: 40px;
	  }
	  .nav-top a.mui-control-item{
  		font-size: 14px;
  		color: #949494!important;
  		width: 50px;
	    display: block;
	    margin: 0 auto;
	    height: 40px;
	    line-height: 40px;
	  }
	  .nav-top a.mui-control-item.mui-active{
	  	color: #000!important;
	    margin-bottom: -1px;
	  }
	  #rank,#new{
	  	padding: 10px;
	  }
	  .btn-vote{
	  	/*width:64px;*/
	  	height: 25px;
	  	border: none;
	  	background: url('img/ic_vote2.png') no-repeat;
	  	background-size: 18px 18px;
	  	background-position: left center;
	  	display: block;
	  	margin: 6px auto;
	  	color: #949494;
	  	text-indent: 15px
	  }
		</style>
	</head>
	<body>
    <!-- <header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">排行榜</h1>
		</header> -->
		<div class="mui-content">
			<div class="bar-search">
				<input type="tel" name="" placeholder="请输入编号搜索" id="search">
			</div>
			<div class="mui-row mui-slider-indicator mui-segmented-control mui-segmented-control-inverted nav-top">
				<div class="mui-col-xs-6 mui-text-center"><a class="mui-control-item mui-active" href="#rank">最热</a></div>
				<div class="mui-col-xs-6 mui-text-center"><a class="mui-control-item" href="#new">最新</a></div>
			</div>
			<div id="rank" class="mui-control-content mui-row mui-active"></div>
			<div id="new" class="mui-control-content mui-row"></div>
		</div>
	</body>
</html>
<script type="text/x-tmpl" id="tmpl-rank">
{% for (var i = 0; i < o.length; i++) { %}
<div class="mui-col-xs-6 artist-rank" data-rankid="{%=o[i].id%}">
	<div class="rank-cover" >
		<img class="lazy" data-original="{%=o[i].worksPicUrl+'?imageMogr2/thumbnail/375x375'%}" data-preview-src="{%=o[i].worksPicUrl+'?imageMogr2/thumbnail/750x750'%}" data-preview-group="hot_{%=o[i].id%}">
		<div class="rank-no"><span>TOP {%=o[i].rownum%}</span></div>
	</div>
	<div class="rank-info">
		<h4 class="mui-ellipsis">{%=o[i].worksName%}</h4>
		<div class="mui-row">
			<div class="mui-col-xs-6 mui-text-center"><span>作者：{%=o[i].author%}</span></div>
			<div class="mui-col-xs-6 mui-text-center"><span>编号：{%=o[i].id%}</span></div>
		</div>
		<button class="btn-vote" data-id="{%=o[i].id%}">{%=o[i].voteNumber%}</button>
	</div>
</div>
{% } %}
</script>
<script type="text/x-tmpl" id="tmpl-new">
{% for (var i = 0; i < o.length; i++) { %}
<div class="mui-col-xs-6 artist-rank" data-rankid="{%=o[i].id%}">
	<div class="rank-cover" >
		<img class="lazy" data-original="{%=o[i].worksPicUrl+'?imageMogr2/thumbnail/375x375'%}" data-preview-src="{%=o[i].worksPicUrl+'?imageMogr2/thumbnail/750x750'%}" data-preview-group="new_{%=o[i].id%}">
		<div class="rank-no"><span>TOP {%=o[i].rownum%}</span></div>
	</div>
	<div class="rank-info">
		<h4 class="mui-ellipsis">{%=o[i].worksName%}</h4>
		<div class="mui-row">
			<div class="mui-col-xs-6 mui-text-center"><span>作者：{%=o[i].author%}</span></div>
			<div class="mui-col-xs-6 mui-text-center"><span>编号：{%=o[i].id%}</span></div>
		</div>
		<button class="btn-vote" data-id="{%=o[i].id%}">{%=o[i].voteNumber%}</button>
	</div>
</div>
{% } %}
</script>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/tmpl.min.js"></script>
<script type="text/javascript" src="js/jquery.lazyload.min.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script src="//cdn.bootcss.com/jquery.sticky/1.0.3/jquery.sticky.min.js"></script>
<script src="js/mui.zoom.js"></script>
<script src="js/mui.previewimage.js"></script>
<script type="text/javascript" charset="UTF-8">
var pageIndex = 1, pageIndexNew = 1;
mui('#rank').on('tap', '.btn-more-hot', function(event) {
	event.preventDefault();
	pageIndex++;		
	rank(pageIndex);
});
mui('#new').on('tap', '.btn-more-new', function(event) {
	event.preventDefault();
	pageIndexNew++;		
	newest(pageIndexNew);
});
mui('.mui-content').on('tap', '.btn-vote', function(event) {
	event.preventDefault();
	var that = $(this);
	$.ajax({
		url: biqiangBaseUrl+'/api/v1/user/0/compareWall/activity/vote',
		type: 'POST',
		data: {
			'workId': $(this).data('id'),
			'token': 'df68e038-143e-41cb-b554-456f78f184fc'
		},
		beforeSend: function(){
      $('.btn-vote').attr('disabled', 'disabled');
    }
	})
	.done(function(data) {
	  if (data.status=='200') {
	  	if (data.data) {
	  		pTip('投票成功');
	  		that.text(parseInt(that.text())+1);
	  	}else{
	  		pTip('今天的票已经投过了！');
	  	}
	  }
	})
	.always(function() {
		$('.btn-vote').removeAttr('disabled');
	});
});
$(function(){
	$('.nav-top').sticky({topSpacing:0});
	$('#search').keyup(function(event) {
		var s = $(this).val();
    if (s.length>0) {
    	search(s);
    }else{
    	pageIndex = 1;
    	$('#rank').empty();
    	rank(pageIndex);
    }
	});
	rank(pageIndex);
	newest(pageIndexNew);
});
var rank = function(pageIndex){
	$.getJSON(biqiangBaseUrl+'/api/v1/user/0/compareWall/activity/rankingList',{'token':'df68e038-143e-41cb-b554-456f78f184fc','pageIndex':pageIndex,'sortType':0},function(data) {
	  if (data.status=='200') {
	  	if (data.data.length>0) {
	  		$('.btn-more-hot').remove();
				var rank = tmpl('tmpl-rank',data.data);
		    $('#rank').append(rank);
		    if (data.data.length==10&&$('.btn-more-hot').length===0) {
		    	$('#rank').append('<button class="btn-more btn-more-hot">查看更多</button>');
		    }
		    if (data.data.length<10) {
		  		$('#rank').append("<p class='p-null'>没有更多数据~<p>");
		    }
				$('.rank-cover').height(($(window).width()-28)/2);
				$('.lazy').lazyload({placeholder:"img/f4f4f4.png",effect:"fadeIn"}).removeClass('lazy');
				mui.previewImage();
	  	} else {
	  		if ($('.artist-rank').length===0) {
		  		$('#rank').html("<p class='p-null'>没有更多数据~<p>");
	  		}
	  	}		
			// $('#slider').height($('.mui-control-content.mui-active').height()+50);
	  }
	});
};
var newest = function(pageIndex){
	$.getJSON(biqiangBaseUrl+'/api/v1/user/0/compareWall/activity/rankingList',{'token':'df68e038-143e-41cb-b554-456f78f184fc','pageIndex':pageIndexNew,'sortType':1},function(data) {
	  if (data.status=='200') {
	  	if (data.data.length>0) {
	  		$('.btn-more-new').remove();
				var rank = tmpl('tmpl-new',data.data);
		    $('#new').append(rank);
		    if (data.data.length==10&&$('.btn-more-new').length===0) {
		    	$('#new').append('<button class="btn-more btn-more-new">查看更多</button>');
		    }
		    if (data.data.length<10) {
		  		$('#new').append("<p class='p-null'>没有更多数据~<p>");
		    }
				$('.rank-cover').height(($(window).width()-28)/2);
				$('.lazy').lazyload({placeholder:"img/f4f4f4.png",effect:"fadeIn"}).removeClass('lazy');
				mui.previewImage();
	  	} else {
	  		if ($('.artist-rank').length===0) {
		  		$('#new').html("<p class='p-null'>没有更多数据~<p>");
	  		}
	  	}		
			// $('#slider').height($('.mui-control-content.mui-active').height()+50);
	  }
	});
};
var search =function(id){
	$.getJSON(biqiangBaseUrl+'/api/v1/user/0/compareWall/activity/workDetail', {'workId': id,'token':'df68e038-143e-41cb-b554-456f78f184fc'}, function(data, textStatus) {
	  if (data.status=='200') {
	  	if (data.data) {
	  		var arr = [];
		  	arr[0] = data.data;
		  	var temp = tmpl('tmpl-rank', arr);
	      $('#rank').html(temp);
	      $('.rank-cover').height(($(window).width()-28)/2);
				$('.lazy').lazyload({placeholder:"img/f4f4f4.png",effect:"fadeIn"}).removeClass('lazy');
	  	}else{
	      $('#rank').html("<p class='p-null'>没有找到该记录~<p>");
	  	}
		}
	});
};
</script>
